```
create table stock(
  id int not null auto_increment primary key comment "主键id",
  sku_id int not null unique key comment "sku id",
  count int not null comment "库存"
)engine = innodb comment "库存表";

create table order_item(
  id int not null auto_increment primary key comment "主键id",
  sku_id int not null comment "sku_id",
  user_name varchar(32) not null comment "下单用户名"
)engine=innodb comment "订单表";

insert into stock(sku_id,count) value(1234,1);  //在只有一个库存的情况下

```
## 一般的减库存逻辑
1.开启事务<br>
2.查库存<br>
3.判断库存<br>
4.将库存减一<br>
5.写订单<br>
6.写订单失败，回滚<br>
6.写订单成功，提交事务<br>
## 在repeatable read级别下一般的减库存逻辑是会发生超卖的

||session A|session B|
|:---|:---|:---|
|1|begin|begin|
|2|select count from stock where sku_id = 1234;//得到库存为1|select count from stock where sku_id = 1234;//得到库存为1|
|3|update stock set count=count-1 where sku_id = 1234;||
|4||update stock set count=count-1 where sku_id = 1234;  //阻塞，因为session A没提交，没释放锁|
